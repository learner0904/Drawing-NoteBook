{"ast":null,"code":"import \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport { create } from \"../context.js\";\nimport { composeRender, marks, withTip } from \"../mark.js\";\nimport { identity, indexOf, isNoneish, labelof, maybeColorChannel, maybeValue, valueof } from \"../options.js\";\nimport { inferScaleOrder } from \"../scales.js\";\nimport { getClipId } from \"../style.js\";\nimport { area } from \"./area.js\";\nimport { line } from \"./line.js\";\nexport function differenceX(data, options) {\n  return differenceK(\"x\", data, options);\n}\nexport function differenceY(data, options) {\n  return differenceK(\"y\", data, options);\n}\nfunction differenceK(k, data, {\n  x1,\n  x2,\n  y1,\n  y2,\n  x = x1 === undefined && x2 === undefined ? k === \"y\" ? indexOf : identity : undefined,\n  y = y1 === undefined && y2 === undefined ? k === \"x\" ? indexOf : identity : undefined,\n  fill,\n  // ignored\n  positiveFill = \"#3ca951\",\n  negativeFill = \"#4269d0\",\n  fillOpacity = 1,\n  positiveFillOpacity = fillOpacity,\n  negativeFillOpacity = fillOpacity,\n  stroke,\n  strokeOpacity,\n  z = maybeColorChannel(stroke)[0],\n  clip,\n  // optional additional clip for area\n  tip,\n  render,\n  ...options\n} = {}) {\n  [x1, x2] = memoTuple(x, x1, x2);\n  [y1, y2] = memoTuple(y, y1, y2);\n  if (x1 === x2 && y1 === y2) {\n    if (k === \"y\") y1 = memo(0);else x1 = memo(0);\n  }\n  ({\n    tip\n  } = withTip({\n    tip\n  }, k === \"y\" ? \"x\" : \"y\"));\n  return marks(!isNoneish(positiveFill) ? Object.assign(area(data, {\n    x1,\n    x2,\n    y1,\n    y2,\n    z,\n    fill: positiveFill,\n    fillOpacity: positiveFillOpacity,\n    render: composeRender(render, clipDifference(k, true)),\n    clip,\n    ...options\n  }), {\n    ariaLabel: \"positive difference\"\n  }) : null, !isNoneish(negativeFill) ? Object.assign(area(data, {\n    x1,\n    x2,\n    y1,\n    y2,\n    z,\n    fill: negativeFill,\n    fillOpacity: negativeFillOpacity,\n    render: composeRender(render, clipDifference(k, false)),\n    clip,\n    ...options\n  }), {\n    ariaLabel: \"negative difference\"\n  }) : null, line(data, {\n    x: x2,\n    y: y2,\n    z,\n    stroke,\n    strokeOpacity,\n    tip,\n    clip: true,\n    ...options\n  }));\n}\nfunction memoTuple(x, x1, x2) {\n  if (x1 === undefined && x2 === undefined) {\n    // {x} → [x, x]\n    x1 = x2 = memo(x);\n  } else if (x1 === undefined) {\n    // {x2} → [x2, x2]\n    // {x, x2} → [x, x2]\n    x2 = memo(x2);\n    x1 = x === undefined ? x2 : memo(x);\n  } else if (x2 === undefined) {\n    // {x1} → [x1, x1]\n    // {x, x1} → [x1, x]\n    x1 = memo(x1);\n    x2 = x === undefined ? x1 : memo(x);\n  } else {\n    // {x1, x2} → [x1, x2]\n    x1 = memo(x1);\n    x2 = memo(x2);\n  }\n  return [x1, x2];\n}\nfunction memo(v) {\n  let V;\n  const {\n    value,\n    label = labelof(value)\n  } = maybeValue(v);\n  return {\n    transform: data => V || (V = valueof(data, value)),\n    label\n  };\n}\nfunction clipDifference(k, positive) {\n  const f = k === \"x\" ? \"y\" : \"x\"; // f is the flipped dimension\n  const f1 = `${f}1`;\n  const f2 = `${f}2`;\n  const k1 = `${k}1`;\n  const k2 = `${k}2`;\n  return (index, scales, channels, dimensions, context, next) => {\n    const {\n      [f1]: F1,\n      [f2]: F2\n    } = channels;\n    const K1 = new Float32Array(F1.length);\n    const K2 = new Float32Array(F2.length);\n    const m = dimensions[k === \"y\" ? \"height\" : \"width\"];\n    (positive === inferScaleOrder(scales[k]) < 0 ? K1 : K2).fill(m);\n    const oc = next(index, scales, {\n      ...channels,\n      [f2]: F1,\n      [k2]: K2\n    }, dimensions, context);\n    const og = next(index, scales, {\n      ...channels,\n      [f1]: F2,\n      [k1]: K1\n    }, dimensions, context);\n    const c = oc.querySelector(\"g\") ?? oc; // applyClip\n    const g = og.querySelector(\"g\") ?? og; // applyClip\n    for (let i = 0; c.firstChild; i += 2) {\n      const id = getClipId();\n      const clipPath = create(\"svg:clipPath\", context).attr(\"id\", id).node();\n      clipPath.appendChild(c.firstChild);\n      g.childNodes[i].setAttribute(\"clip-path\", `url(#${id})`);\n      g.insertBefore(clipPath, g.childNodes[i]);\n    }\n    return og;\n  };\n}","map":{"version":3,"names":["create","composeRender","marks","withTip","identity","indexOf","isNoneish","labelof","maybeColorChannel","maybeValue","valueof","inferScaleOrder","getClipId","area","line","differenceX","data","options","differenceK","differenceY","k","x1","x2","y1","y2","x","undefined","y","fill","positiveFill","negativeFill","fillOpacity","positiveFillOpacity","negativeFillOpacity","stroke","strokeOpacity","z","clip","tip","render","memoTuple","memo","Object","assign","clipDifference","ariaLabel","v","V","value","label","transform","positive","f","f1","f2","k1","k2","index","scales","channels","dimensions","context","next","F1","F2","K1","Float32Array","length","K2","m","oc","og","c","querySelector","g","i","firstChild","id","clipPath","attr","node","appendChild","childNodes","setAttribute","insertBefore"],"sources":["D:/Notebooks/notebooks-web/vue/node_modules/@observablehq/plot/src/marks/difference.js"],"sourcesContent":["import {create} from \"../context.js\";\nimport {composeRender, marks, withTip} from \"../mark.js\";\nimport {identity, indexOf, isNoneish, labelof, maybeColorChannel, maybeValue, valueof} from \"../options.js\";\nimport {inferScaleOrder} from \"../scales.js\";\nimport {getClipId} from \"../style.js\";\nimport {area} from \"./area.js\";\nimport {line} from \"./line.js\";\n\nexport function differenceX(data, options) {\n  return differenceK(\"x\", data, options);\n}\n\nexport function differenceY(data, options) {\n  return differenceK(\"y\", data, options);\n}\n\nfunction differenceK(\n  k,\n  data,\n  {\n    x1,\n    x2,\n    y1,\n    y2,\n    x = x1 === undefined && x2 === undefined ? (k === \"y\" ? indexOf : identity) : undefined,\n    y = y1 === undefined && y2 === undefined ? (k === \"x\" ? indexOf : identity) : undefined,\n    fill, // ignored\n    positiveFill = \"#3ca951\",\n    negativeFill = \"#4269d0\",\n    fillOpacity = 1,\n    positiveFillOpacity = fillOpacity,\n    negativeFillOpacity = fillOpacity,\n    stroke,\n    strokeOpacity,\n    z = maybeColorChannel(stroke)[0],\n    clip, // optional additional clip for area\n    tip,\n    render,\n    ...options\n  } = {}\n) {\n  [x1, x2] = memoTuple(x, x1, x2);\n  [y1, y2] = memoTuple(y, y1, y2);\n  if (x1 === x2 && y1 === y2) {\n    if (k === \"y\") y1 = memo(0);\n    else x1 = memo(0);\n  }\n  ({tip} = withTip({tip}, k === \"y\" ? \"x\" : \"y\"));\n  return marks(\n    !isNoneish(positiveFill)\n      ? Object.assign(\n          area(data, {\n            x1,\n            x2,\n            y1,\n            y2,\n            z,\n            fill: positiveFill,\n            fillOpacity: positiveFillOpacity,\n            render: composeRender(render, clipDifference(k, true)),\n            clip,\n            ...options\n          }),\n          {ariaLabel: \"positive difference\"}\n        )\n      : null,\n    !isNoneish(negativeFill)\n      ? Object.assign(\n          area(data, {\n            x1,\n            x2,\n            y1,\n            y2,\n            z,\n            fill: negativeFill,\n            fillOpacity: negativeFillOpacity,\n            render: composeRender(render, clipDifference(k, false)),\n            clip,\n            ...options\n          }),\n          {ariaLabel: \"negative difference\"}\n        )\n      : null,\n    line(data, {\n      x: x2,\n      y: y2,\n      z,\n      stroke,\n      strokeOpacity,\n      tip,\n      clip: true,\n      ...options\n    })\n  );\n}\n\nfunction memoTuple(x, x1, x2) {\n  if (x1 === undefined && x2 === undefined) {\n    // {x} → [x, x]\n    x1 = x2 = memo(x);\n  } else if (x1 === undefined) {\n    // {x2} → [x2, x2]\n    // {x, x2} → [x, x2]\n    x2 = memo(x2);\n    x1 = x === undefined ? x2 : memo(x);\n  } else if (x2 === undefined) {\n    // {x1} → [x1, x1]\n    // {x, x1} → [x1, x]\n    x1 = memo(x1);\n    x2 = x === undefined ? x1 : memo(x);\n  } else {\n    // {x1, x2} → [x1, x2]\n    x1 = memo(x1);\n    x2 = memo(x2);\n  }\n  return [x1, x2];\n}\n\nfunction memo(v) {\n  let V;\n  const {value, label = labelof(value)} = maybeValue(v);\n  return {transform: (data) => V || (V = valueof(data, value)), label};\n}\n\nfunction clipDifference(k, positive) {\n  const f = k === \"x\" ? \"y\" : \"x\"; // f is the flipped dimension\n  const f1 = `${f}1`;\n  const f2 = `${f}2`;\n  const k1 = `${k}1`;\n  const k2 = `${k}2`;\n  return (index, scales, channels, dimensions, context, next) => {\n    const {[f1]: F1, [f2]: F2} = channels;\n    const K1 = new Float32Array(F1.length);\n    const K2 = new Float32Array(F2.length);\n    const m = dimensions[k === \"y\" ? \"height\" : \"width\"];\n    (positive === inferScaleOrder(scales[k]) < 0 ? K1 : K2).fill(m);\n    const oc = next(index, scales, {...channels, [f2]: F1, [k2]: K2}, dimensions, context);\n    const og = next(index, scales, {...channels, [f1]: F2, [k1]: K1}, dimensions, context);\n    const c = oc.querySelector(\"g\") ?? oc; // applyClip\n    const g = og.querySelector(\"g\") ?? og; // applyClip\n    for (let i = 0; c.firstChild; i += 2) {\n      const id = getClipId();\n      const clipPath = create(\"svg:clipPath\", context).attr(\"id\", id).node();\n      clipPath.appendChild(c.firstChild);\n      g.childNodes[i].setAttribute(\"clip-path\", `url(#${id})`);\n      g.insertBefore(clipPath, g.childNodes[i]);\n    }\n    return og;\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}